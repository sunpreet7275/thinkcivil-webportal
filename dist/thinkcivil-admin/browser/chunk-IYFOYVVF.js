import{a as Z,b as tt}from"./chunk-KLEPB37Q.js";import"./chunk-7RWCIHFI.js";import{a as nt,b as it,c as rt}from"./chunk-42K7M3JH.js";import"./chunk-U6CKJMGU.js";import{a as et}from"./chunk-MJ27DAE4.js";import"./chunk-7G2NQBXL.js";import{a as j,b as $,c as W,d as z,f as H,g as Y}from"./chunk-Y4AHRI4W.js";import{a as U,b as X}from"./chunk-XMRX5FRA.js";import{b as E,d as P}from"./chunk-GRH6IN53.js";import{L as J,N as K}from"./chunk-7XSJTIVU.js";import"./chunk-ZWY6WOSF.js";import{A as G,f as V,g as q,k as A,l as L,n as N,o as D,y as B,z as R}from"./chunk-MUJPFQ6Z.js";import{Db as d,Ec as S,Ha as f,Mb as i,Nb as r,Nc as Q,Ob as x,Oc as I,Pc as O,Sb as C,Ub as p,Vb as u,Vc as F,ec as o,fb as a,fc as b,gc as _,hc as T,ja as g,jc as k,kc as M,lc as y,ra as c,rb as w,sa as m,xb as v}from"./chunk-SZ6SDWKT.js";function st(l,e){if(l&1&&(i(0,"mat-radio-button",29),o(1),r()),l&2){let t=e.$implicit,n=e.index,s=u(2);d("value",n),a(),_(" ",t[s.selectedLanguage]," ")}}function at(l,e){if(l&1){let t=C();i(0,"button",30),p("click",function(){let s=c(t).index,h=u(2);return m(h.goToQuestion(s))}),o(1),r()}if(l&2){let t=e.index,n=u(2);d("ngClass",n.getQuestionStatusClass(t)),a(),_(" ",t+1," ")}}function lt(l,e){if(l&1){let t=C();i(0,"div",2)(1,"div",3)(2,"div")(3,"strong"),o(4),r(),i(5,"p"),o(6),r()(),i(7,"mat-radio-group",4),y("ngModelChange",function(s){c(t);let h=u();return M(h.selectedLanguage,s)||(h.selectedLanguage=s),m(s)}),i(8,"mat-radio-button",5),o(9,"English"),r(),i(10,"mat-radio-button",6),o(11,"\u0939\u093F\u0928\u094D\u0926\u0940"),r()(),i(12,"div",7),o(13," Time Left: "),i(14,"strong"),o(15),r()()(),i(16,"form",8)(17,"div",9)(18,"mat-card",10)(19,"mat-card-header")(20,"mat-card-title"),o(21),r(),i(22,"mat-card-subtitle"),o(23),r()(),i(24,"mat-card-content")(25,"p",11),o(26),r(),i(27,"mat-radio-group",12),v(28,st,2,2,"mat-radio-button",13),r()()(),i(29,"div",14)(30,"button",15),p("click",function(){c(t);let s=u();return m(s.previousQuestion())}),o(31," \u2190 Previous "),r(),i(32,"button",16),p("click",function(){c(t);let s=u();return m(s.clearAnswer())}),o(33," Clear "),r(),i(34,"button",17),p("click",function(){c(t);let s=u();return m(s.markForReview())}),o(35," Mark for Review "),r(),i(36,"button",18),p("click",function(){c(t);let s=u();return m(s.saveAndNext())}),o(37," Save & Next \u2192 "),r()()(),i(38,"div",19)(39,"h3"),o(40,"Questions"),r(),i(41,"div",20),v(42,at,2,2,"button",21),r(),i(43,"div",22)(44,"div",23),x(45,"div",24),i(46,"span"),o(47,"Answered"),r()(),i(48,"div",23),x(49,"div",25),i(50,"span"),o(51,"Not Answered"),r()(),i(52,"div",23),x(53,"div",26),i(54,"span"),o(55,"Marked for Review"),r()(),i(56,"div",23),x(57,"div",27),i(58,"span"),o(59,"Current Question"),r()()(),i(60,"button",28),p("click",function(){c(t);let s=u();return m(s.submitTest())}),o(61," Submit Test "),r()()()()}if(l&2){let t=u();a(4),b(t.test().title),a(2),b(t.test().description),a(),k("ngModel",t.selectedLanguage),a(8),b(t.formatTime(t.timeLeft())),a(),d("formGroup",t.testForm),a(5),T("Question ",t.currentQuestionIndex()+1," of ",t.test().questions.length,""),a(2),_("Marks: ",t.currentQuestion().marks,""),a(3),_(" ",t.currentQuestion().question[t.selectedLanguage]," "),a(),d("formControl",t.getAnswerControl(t.currentQuestionIndex())),a(),d("ngForOf",t.currentQuestion().options),a(2),d("disabled",t.currentQuestionIndex()===0),a(12),d("ngForOf",t.test().questions)}}function ut(l,e){l&1&&(i(0,"div",31),x(1,"mat-spinner",32),i(2,"p"),o(3,"Loading test..."),r()())}var ot=class l{route=g(E);router=g(P);fb=g(B);testService=g(et);snackBar=g(Z);test=f(null);loading=f(!1);timeLeft=f(0);currentQuestionIndex=f(0);reviewQuestions=f([]);testForm;timer;startTime=new Date;selectedLanguage="english";currentQuestion=S(()=>{let e=this.test(),t=this.currentQuestionIndex();return e&&e.questions?e.questions[t]:null});constructor(){this.testForm=this.fb.group({answers:this.fb.array([])})}ngOnInit(){let e=this.route.snapshot.paramMap.get("id");e&&this.loadTest(e)}loadTest(e){this.loading.set(!0),this.testService.getTestById(e).subscribe({next:t=>{this.test.set(t),this.timeLeft.set(t.duration*60),this.initializeForm(t),this.startTimer(),this.loading.set(!1)},error:()=>{this.snackBar.open("Error loading test!","Close",{duration:4e3}),this.loading.set(!1),this.router.navigate(["/live-tests"])}})}initializeForm(e){let t=this.answers;t.clear(),e.questions.forEach(()=>{t.push(this.fb.control(null))})}get answers(){return this.testForm.get("answers")}getAnswerControl(e){return this.answers.at(e)}startTimer(){this.timer=setInterval(()=>{this.timeLeft.set(this.timeLeft()-1),this.timeLeft()<=0&&this.submitTest()},1e3)}formatTime(e){let t=Math.floor(e/60),n=e%60;return`${t}:${n.toString().padStart(2,"0")}`}previousQuestion(){this.currentQuestionIndex()>0&&this.currentQuestionIndex.set(this.currentQuestionIndex()-1)}nextQuestion(){this.currentQuestionIndex()<this.test().questions.length-1&&this.currentQuestionIndex.set(this.currentQuestionIndex()+1)}goToQuestion(e){this.currentQuestionIndex.set(e)}clearAnswer(){this.getAnswerControl(this.currentQuestionIndex()).setValue(null)}markForReview(){let e=this.currentQuestionIndex(),t=this.reviewQuestions();t.includes(e)||this.reviewQuestions.set([...t,e]),this.nextQuestion()}saveAndNext(){let e=this.currentQuestionIndex(),t=this.reviewQuestions();t.includes(e)&&this.reviewQuestions.set(t.filter(n=>n!==e)),this.nextQuestion()}getQuestionStatusClass(e){let t=this.answers.at(e).value!==null,n=this.reviewQuestions().includes(e);return e===this.currentQuestionIndex()?"current":n?"marked-review":t?"answered":"not-answered"}submitTest(){this.timer&&clearInterval(this.timer);let e=this.answers.controls.map((n,s)=>n.value===null?s+1:null).filter(n=>n!==null);if(e.length>0){let n=`You have ${e.length} unanswered questions: ${e.join(", ")}. Submit anyway?`;if(!confirm(n)){this.startTimer();return}}let t={answers:this.answers.value.map(n=>({selectedOption:n??-1})),timeTaken:Math.floor((new Date().getTime()-this.startTime.getTime())/1e3)};this.testService.submitTest(this.test()._id,t).subscribe({next:n=>{this.snackBar.open(`Test submitted! Score: ${n.score}/${n.totalMarks}`,"Close",{duration:5e3}),this.router.navigate(["/dashboard"])},error:()=>{this.loading.set(!1),this.snackBar.open("Error submitting test!","Close",{duration:4e3})}})}ngOnDestroy(){this.timer&&clearInterval(this.timer)}static \u0275fac=function(t){return new(t||l)};static \u0275cmp=w({type:l,selectors:[["app-take-test"]],decls:2,vars:2,consts:[["class","test-wrapper",4,"ngIf"],["class","loading-center",4,"ngIf"],[1,"test-wrapper"],[1,"header-bar"],[1,"language-toggle",3,"ngModelChange","ngModel"],["value","english"],["value","hindi"],[1,"timer"],[1,"test-grid",3,"formGroup"],[1,"question-panel"],[1,"question-card"],[1,"question-text"],[1,"options-group",3,"formControl"],["class","option-button",3,"value",4,"ngFor","ngForOf"],[1,"navigation-buttons"],["mat-raised-button","","type","button",3,"click","disabled"],["mat-raised-button","","type","button","color","warn",3,"click"],["mat-raised-button","","type","button","color","accent",3,"click"],["mat-raised-button","","type","button","color","primary",3,"click"],[1,"side-panel"],[1,"question-palette"],["type","button","class","palette-btn",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"legend"],[1,"legend-item"],[1,"color-box","answered"],[1,"color-box","not-answered"],[1,"color-box","marked-review"],[1,"color-box","current"],["mat-raised-button","","color","primary",1,"submit-btn",3,"click"],[1,"option-button",3,"value"],["type","button",1,"palette-btn",3,"click","ngClass"],[1,"loading-center"],["diameter","50"]],template:function(t,n){t&1&&v(0,lt,62,13,"div",0)(1,ut,4,0,"div",1),t&2&&(d("ngIf",n.test()&&!n.loading()),a(),d("ngIf",n.loading()))},dependencies:[R,L,V,q,A,F,Q,I,O,G,N,D,Y,j,W,H,z,$,K,J,rt,nt,it,tt,X,U],styles:[".test-wrapper[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column}.header-bar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:15px 20px;background:#f3f3f3;border-bottom:1px solid #ddd}.test-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:70% 30%;height:calc(100vh - 100px)}.question-panel[_ngcontent-%COMP%]{overflow-y:auto;padding:15px;display:flex;flex-direction:column;height:100%}.question-card[_ngcontent-%COMP%]{margin-bottom:20px;flex-grow:1}.navigation-buttons[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-top:20px;gap:10px}.navigation-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1}.side-panel[_ngcontent-%COMP%]{padding:20px;border-left:2px solid #e0e0e0;background:#fafafa}.question-palette[_ngcontent-%COMP%]{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:20px}.palette-btn[_ngcontent-%COMP%]{width:45px;height:45px;border-radius:50%;border:none;cursor:pointer;font-weight:700;transition:all .2s ease}.answered[_ngcontent-%COMP%]{background:#4caf50;color:#fff}.not-answered[_ngcontent-%COMP%]{background:#f44336;color:#fff}.marked-review[_ngcontent-%COMP%]{background:#ff9800;color:#fff}.current[_ngcontent-%COMP%]{background:#2196f3;color:#fff;border:3px solid #0d47a1}.legend[_ngcontent-%COMP%]{margin-bottom:20px}.legend-item[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:8px}.color-box[_ngcontent-%COMP%]{width:20px;height:20px;border-radius:4px;margin-right:10px}.submit-btn[_ngcontent-%COMP%]{width:100%}.loading-center[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;height:80vh}"]})};export{ot as TakeTestComponent};
