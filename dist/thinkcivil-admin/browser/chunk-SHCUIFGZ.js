import{a as ft,b as xt,c as vt,d as Ct,e as ht,f as Mt,g as St,h as bt,i as Tt,j as Pt,k as yt}from"./chunk-T4LTT3C7.js";import{a as ut,c as gt}from"./chunk-GHQD5XIY.js";import{c as G}from"./chunk-UG3TAOCT.js";import{a as rt}from"./chunk-T5SKTLKE.js";import{a as W}from"./chunk-2H4Z2K4R.js";import{a as Rt,b as At,c as It}from"./chunk-UBVSGTYP.js";import{a as Et,b as Ot,c as wt}from"./chunk-42K7M3JH.js";import"./chunk-U6CKJMGU.js";import"./chunk-CRTYOTUM.js";import{b as at,h as ot}from"./chunk-OBP7X3GA.js";import"./chunk-GL2RTCLG.js";import{a as ct,b as pt}from"./chunk-BFQVRRBQ.js";import{a as _t}from"./chunk-MJ27DAE4.js";import"./chunk-7G2NQBXL.js";import{a as Y,b as Z,c as tt,d as et,f as nt,g as it}from"./chunk-Y4AHRI4W.js";import{a as dt,b as mt}from"./chunk-XMRX5FRA.js";import{b as Q,d as U}from"./chunk-GRH6IN53.js";import{L as lt,N as st}from"./chunk-7XSJTIVU.js";import"./chunk-ZWY6WOSF.js";import{f as J,k as K,z as X}from"./chunk-MUJPFQ6Z.js";import{Db as s,Eb as D,Fb as L,Gb as q,Ha as M,Mb as i,Nb as a,Ob as h,Oc as z,Pb as g,Pc as j,Qb as f,Sb as E,Tc as B,Ub as O,Vb as v,Vc as V,cb as I,ec as o,fb as r,fc as _,gc as C,hc as w,ja as b,jc as H,kc as F,lc as N,oc as $,qc as R,ra as P,rb as k,sa as y,sc as A,xb as d}from"./chunk-SZ6SDWKT.js";var Dt=()=>[];function Lt(e,t){if(e&1&&(i(0,"mat-option",11),o(1),R(2,"date"),a()),e&2){let n=t.$implicit;s("value",n._id),r(),w(" ",n.title," - ",A(2,3,n.startTime,"medium")," ")}}function qt(e,t){if(e&1){let n=E();i(0,"button",12),O("click",function(){P(n);let m=v();return y(m.exportResults())}),i(1,"mat-icon"),o(2,"download"),a(),o(3," Export Results "),a()}}function Ht(e,t){e&1&&(i(0,"div",13),h(1,"mat-spinner"),i(2,"p"),o(3,"Loading results..."),a()())}function Ft(e,t){e&1&&(i(0,"div",15)(1,"mat-card")(2,"mat-card-content")(3,"p"),o(4,"No results available for this test yet."),a(),i(5,"p"),o(6,"Students need to submit their answers to see results."),a()()()())}function Nt(e,t){e&1&&(i(0,"th",30),o(1,"Rank"),a())}function $t(e,t){if(e&1&&(i(0,"td",31)(1,"span",32),o(2),a()()),e&2){let n=t.$implicit,l=v(3);r(),D("background",l.getRankColor(n.rank)),r(),C(" ",n.rank," ")}}function zt(e,t){e&1&&(i(0,"th",30),o(1,"Student"),a())}function jt(e,t){if(e&1&&(i(0,"td",31)(1,"div",33)(2,"strong"),o(3),a(),i(4,"small"),o(5),a()()()),e&2){let n=t.$implicit;r(3),_(n.student.fullName),r(2),_(n.student.email)}}function Bt(e,t){e&1&&(i(0,"th",30),o(1,"Score"),a())}function Vt(e,t){if(e&1&&(i(0,"td",31),o(1),a()),e&2){let n=t.$implicit;r(),w(" ",n.score,"/",n.totalMarks," ")}}function Qt(e,t){e&1&&(i(0,"th",30),o(1,"Percentage"),a())}function Ut(e,t){if(e&1&&(i(0,"td",31)(1,"span"),o(2),a()()),e&2){let n=t.$implicit;r(),L("high-score",n.percentage>=80)("medium-score",n.percentage>=60&&n.percentage<80)("low-score",n.percentage<60),r(),C(" ",n.percentage,"% ")}}function Gt(e,t){e&1&&(i(0,"th",30),o(1,"Time Taken"),a())}function Wt(e,t){if(e&1&&(i(0,"td",31),o(1),a()),e&2){let n=t.$implicit;r(),C(" ",n.timeTaken," seconds ")}}function Jt(e,t){e&1&&(i(0,"th",30),o(1,"Submitted"),a())}function Kt(e,t){if(e&1&&(i(0,"td",31),o(1),R(2,"date"),a()),e&2){let n=t.$implicit;r(),C(" ",A(2,1,n.submittedAt,"medium")," ")}}function Xt(e,t){e&1&&h(0,"tr",34)}function Yt(e,t){e&1&&h(0,"tr",35)}function Zt(e,t){e&1&&(i(0,"div",13),h(1,"mat-spinner"),i(2,"p"),o(3,"Loading analytics..."),a()())}function te(e,t){if(e&1&&(i(0,"mat-card",50)(1,"mat-card-header")(2,"mat-card-title"),o(3,"Performance Distribution"),a()(),i(4,"mat-card-content")(5,"div",51)(6,"div",52)(7,"h3"),o(8),a(),i(9,"p"),o(10,"Excellent (\u226580%)"),a()(),i(11,"div",53)(12,"h3"),o(13),a(),i(14,"p"),o(15,"Good (60-79%)"),a()(),i(16,"div",54)(17,"h3"),o(18),a(),i(19,"p"),o(20,"Average (40-59%)"),a()(),i(21,"div",55)(22,"h3"),o(23),a(),i(24,"p"),o(25,"Poor (<40%)"),a()()()()()),e&2){let n,l,m,c,x=v(4);r(8),_(((n=x.analytics())==null||n.performanceDistribution==null?null:n.performanceDistribution.excellent)||0),r(5),_(((l=x.analytics())==null||l.performanceDistribution==null?null:l.performanceDistribution.good)||0),r(5),_(((m=x.analytics())==null||m.performanceDistribution==null?null:m.performanceDistribution.average)||0),r(5),_(((c=x.analytics())==null||c.performanceDistribution==null?null:c.performanceDistribution.poor)||0)}}function ee(e,t){e&1&&(i(0,"th",30),o(1,"Question"),a())}function ne(e,t){if(e&1&&(i(0,"td",31)(1,"div",56)(2,"strong"),o(3),a(),h(4,"p",57),a()()),e&2){let n=t.$implicit,l=v(4);r(3),C("Q",n.questionIndex,""),r(),s("innerHTML",l.getQuestionText(n.question),I)}}function ie(e,t){e&1&&(i(0,"th",30),o(1,"Correct"),a())}function ae(e,t){if(e&1&&(i(0,"td",31)(1,"span",58),o(2),a()()),e&2){let n=t.$implicit;r(2),_(n.correctAnswers)}}function oe(e,t){e&1&&(i(0,"th",30),o(1,"Incorrect"),a())}function re(e,t){if(e&1&&(i(0,"td",31)(1,"span",59),o(2),a()()),e&2){let n=t.$implicit;r(2),_(n.incorrectAnswers)}}function le(e,t){e&1&&(i(0,"th",30),o(1,"Correct %"),a())}function se(e,t){if(e&1&&(i(0,"td",31)(1,"span"),o(2),a()()),e&2){let n=t.$implicit,l=v(4);r(),q(l.getPercentageClass(n.correctPercentage)),r(),C(" ",n.correctPercentage,"% ")}}function de(e,t){e&1&&h(0,"tr",34)}function me(e,t){e&1&&h(0,"tr",35)}function ce(e,t){if(e&1){let n=E();i(0,"div")(1,"mat-card",36)(2,"mat-card-header")(3,"mat-card-title"),o(4),a()(),i(5,"mat-card-content")(6,"div",37)(7,"div",38)(8,"h3"),o(9),a(),i(10,"p"),o(11,"Total Students"),a()(),i(12,"div",38)(13,"h3"),o(14),a(),i(15,"p"),o(16,"Average Score"),a()(),i(17,"div",38)(18,"h3"),o(19),a(),i(20,"p"),o(21,"Highest Score"),a()(),i(22,"div",38)(23,"h3"),o(24),a(),i(25,"p"),o(26,"Lowest Score"),a()(),i(27,"div",38)(28,"h3"),o(29),a(),i(30,"p"),o(31,"Average Time"),a()()()()(),d(32,te,26,4,"mat-card",39),i(33,"mat-card",40)(34,"mat-card-header",41)(35,"mat-card-title"),o(36,"Question-wise Analysis"),a(),i(37,"mat-radio-group",42),N("ngModelChange",function(m){P(n);let c=v(3);return F(c.selectedLanguage,m)||(c.selectedLanguage=m),y(m)}),i(38,"mat-radio-button",43),o(39,"English"),a(),i(40,"mat-radio-button",44),o(41,"\u0939\u093F\u0928\u094D\u0926\u0940"),a()()(),i(42,"mat-card-content")(43,"table",45),g(44,46),d(45,ee,2,0,"th",20)(46,ne,5,2,"td",21),f(),g(47,47),d(48,ie,2,0,"th",20)(49,ae,3,1,"td",21),f(),g(50,48),d(51,oe,2,0,"th",20)(52,re,3,1,"td",21),f(),g(53,49),d(54,le,2,0,"th",20)(55,se,3,3,"td",21),f(),d(56,de,1,0,"tr",27)(57,me,1,0,"tr",28),a()()()()}if(e&2){let n,l,m,c,x,S,p,T,u=v(3);r(4),C("Test Overview - ",(n=u.analytics())==null?null:n.testTitle,""),r(5),_((l=u.analytics())==null?null:l.totalStudents),r(5),_((m=u.analytics())==null?null:m.averageScore),r(5),_((c=u.analytics())==null?null:c.highestScore),r(5),_((x=u.analytics())==null?null:x.lowestScore),r(5),C("",(S=u.analytics())==null?null:S.averageTime,"s"),r(3),s("ngIf",(p=u.analytics())==null?null:p.performanceDistribution),r(5),H("ngModel",u.selectedLanguage),r(6),s("dataSource",((T=u.analytics())==null?null:T.questionStats)||$(11,Dt)),r(13),s("matHeaderRowDef",u.analyticsColumns),r(),s("matRowDefColumns",u.analyticsColumns)}}function pe(e,t){if(e&1&&(i(0,"div")(1,"mat-tab-group")(2,"mat-tab",16)(3,"div",17)(4,"mat-card")(5,"mat-card-header")(6,"mat-card-title"),o(7,"Student Rankings"),a(),i(8,"mat-card-subtitle"),o(9),a()(),i(10,"mat-card-content")(11,"table",18),g(12,19),d(13,Nt,2,0,"th",20)(14,$t,3,3,"td",21),f(),g(15,22),d(16,zt,2,0,"th",20)(17,jt,6,2,"td",21),f(),g(18,23),d(19,Bt,2,0,"th",20)(20,Vt,2,2,"td",21),f(),g(21,24),d(22,Qt,2,0,"th",20)(23,Ut,3,7,"td",21),f(),g(24,25),d(25,Gt,2,0,"th",20)(26,Wt,2,1,"td",21),f(),g(27,26),d(28,Jt,2,0,"th",20)(29,Kt,3,4,"td",21),f(),d(30,Xt,1,0,"tr",27)(31,Yt,1,0,"tr",28),a()()()()(),i(32,"mat-tab",29)(33,"div",17),d(34,Zt,4,0,"div",8)(35,ce,58,12,"div",9),a()()()()),e&2){let n=v(2);r(9),C(" Total Students: ",n.rankings().length," "),r(2),s("dataSource",n.rankings()),r(19),s("matHeaderRowDef",n.rankingColumns),r(),s("matRowDefColumns",n.rankingColumns),r(3),s("ngIf",n.analyticsLoading()),r(),s("ngIf",!n.analyticsLoading()&&n.analytics())}}function _e(e,t){if(e&1&&(i(0,"div"),d(1,Ft,7,0,"div",14)(2,pe,36,6,"div",9),a()),e&2){let n=v();r(),s("ngIf",n.rankings().length===0),r(),s("ngIf",n.rankings().length>0)}}function ue(e,t){e&1&&(i(0,"div",60)(1,"mat-card")(2,"mat-card-content")(3,"p"),o(4,"Please select a test to view results and analytics."),a()()()())}var kt=class e{testService=b(_t);authService=b(W);route=b(Q);router=b(U);allTests=M([]);selectedTestId=M("");rankings=M([]);analytics=M(null);loading=M(!1);analyticsLoading=M(!1);selectedLanguage="english";rankingColumns=["rank","student","score","percentage","timeTaken","submittedAt"];analyticsColumns=["question","correctAnswers","incorrectAnswers","correctPercentage"];ngOnInit(){this.loadAllTests(),this.route.queryParams.subscribe(t=>{t.testId&&(this.selectedTestId.set(t.testId),this.loadTestResults(t.testId),this.loadTestAnalytics(t.testId))})}loadAllTests(){this.testService.getAllTests().subscribe({next:t=>{this.allTests.set(t)},error:t=>{console.error("Error loading tests:",t)}})}onTestSelectionChange(t){this.selectedTestId.set(t),this.router.navigate([],{relativeTo:this.route,queryParams:{testId:t},queryParamsHandling:"merge"}),this.loadTestResults(t),this.loadTestAnalytics(t)}loadTestResults(t){this.loading.set(!0),this.testService.getTestResults(t).subscribe({next:n=>{this.rankings.set(n),this.loading.set(!1)},error:n=>{console.error("Error loading results:",n),this.loading.set(!1)}})}loadTestAnalytics(t){this.analyticsLoading.set(!0),this.testService.getTestAnalytics(t).subscribe({next:n=>{this.analytics.set(n),this.analyticsLoading.set(!1)},error:n=>{console.error("Error loading analytics:",n),this.analyticsLoading.set(!1)}})}getQuestionText(t){return t&&(t[this.selectedLanguage]||t.english)||""}getDescriptionText(t){return!t||!t.description?"":t.description[this.selectedLanguage]||t.description.english||""}hasDescription(t){return!!(t?.description&&(t.description[this.selectedLanguage]||t.description.english))}getRankColor(t){return t===1?"gold":t===2?"silver":t===3?"#cd7f32":""}getPercentageClass(t){return t>=70?"high-percentage":t>=40?"medium-percentage":"low-percentage"}exportResults(){let t=this.rankings();if(t.length===0)return;let n=["Rank","Student Name","Email","Score","Total Marks","Percentage","Time Taken (s)","Submitted At"],l=t.map(p=>[p.rank,p.student.fullName,p.student.email,p.score,p.totalMarks,p.percentage+"%",p.timeTaken,new Date(p.submittedAt).toLocaleString()]),m=[n,...l].map(p=>p.map(T=>`"${T}"`).join(",")).join(`
`),c=new Blob([m],{type:"text/csv"}),x=window.URL.createObjectURL(c),S=document.createElement("a");S.href=x,S.download=`test-results-${this.selectedTestId()}.csv`,S.click(),window.URL.revokeObjectURL(x)}static \u0275fac=function(n){return new(n||e)};static \u0275cmp=k({type:e,selectors:[["app-admin-results"]],decls:18,vars:6,consts:[[1,"admin-results-container"],[1,"header"],[1,"test-selection-card"],[1,"selection-header"],["appearance","outline",1,"test-select"],[3,"selectionChange","value"],[3,"value",4,"ngFor","ngForOf"],["mat-raised-button","","color","primary",3,"click",4,"ngIf"],["class","loading",4,"ngIf"],[4,"ngIf"],["class","no-selection",4,"ngIf"],[3,"value"],["mat-raised-button","","color","primary",3,"click"],[1,"loading"],["class","no-results",4,"ngIf"],[1,"no-results"],["label","Student Rankings"],[1,"tab-content"],["mat-table","",1,"rankings-table",3,"dataSource"],["matColumnDef","rank"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","student"],["matColumnDef","score"],["matColumnDef","percentage"],["matColumnDef","timeTaken"],["matColumnDef","submittedAt"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["label","Test Analytics"],["mat-header-cell",""],["mat-cell",""],[1,"rank-badge"],[1,"student-info"],["mat-header-row",""],["mat-row",""],[1,"analytics-card"],[1,"stats-grid"],[1,"stat-item"],["class","distribution-card",4,"ngIf"],[1,"questions-card"],[1,"questions-card-header"],[1,"language-toggle",3,"ngModelChange","ngModel"],["value","english"],["value","hindi"],["mat-table","",1,"questions-table",3,"dataSource"],["matColumnDef","question"],["matColumnDef","correctAnswers"],["matColumnDef","incorrectAnswers"],["matColumnDef","correctPercentage"],[1,"distribution-card"],[1,"distribution-grid"],[1,"dist-item","excellent"],[1,"dist-item","good"],[1,"dist-item","average"],[1,"dist-item","poor"],[1,"question-content"],[1,"question-text",3,"innerHTML"],[1,"correct-count"],[1,"incorrect-count"],[1,"no-selection"]],template:function(n,l){n&1&&(i(0,"div",0)(1,"div",1)(2,"h1"),o(3,"Test Results & Analytics"),a(),i(4,"p"),o(5,"View student rankings and test performance analytics"),a()(),i(6,"mat-card",2)(7,"mat-card-content")(8,"div",3)(9,"mat-form-field",4)(10,"mat-label"),o(11,"Select Test"),a(),i(12,"mat-select",5),O("selectionChange",function(c){return l.onTestSelectionChange(c.value)}),d(13,Lt,3,6,"mat-option",6),a()(),d(14,qt,4,0,"button",7),a()()(),d(15,Ht,4,0,"div",8)(16,_e,3,2,"div",9)(17,ue,5,0,"div",10),a()),n&2&&(r(12),s("value",l.selectedTestId()),r(),s("ngForOf",l.allTests()),r(),s("ngIf",l.selectedTestId()&&l.rankings().length>0),r(),s("ngIf",l.loading()),r(),s("ngIf",!l.loading()&&l.selectedTestId()),r(),s("ngIf",!l.loading()&&!l.selectedTestId()))},dependencies:[V,z,j,B,X,J,K,it,Y,tt,nt,et,Z,yt,ft,vt,St,Ct,xt,bt,ht,Mt,Tt,Pt,It,Rt,At,st,lt,pt,ct,mt,dt,gt,ot,at,ut,G,rt,wt,Et,Ot],styles:[".admin-results-container[_ngcontent-%COMP%]{padding:20px}.header[_ngcontent-%COMP%]{margin-bottom:30px}.header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;color:#3f51b5}.header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:5px 0 0;color:#666}.test-selection-card[_ngcontent-%COMP%]{margin-bottom:20px}.selection-header[_ngcontent-%COMP%]{display:flex;gap:15px;align-items:center;flex-wrap:wrap}.test-select[_ngcontent-%COMP%]{min-width:300px}.loading[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px;gap:20px}.no-results[_ngcontent-%COMP%], .no-selection[_ngcontent-%COMP%]{text-align:center;padding:40px}.tab-content[_ngcontent-%COMP%]{padding:20px 0}.rankings-table[_ngcontent-%COMP%], .questions-table[_ngcontent-%COMP%]{width:100%}.student-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.student-info[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{margin-bottom:4px}.student-info[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:#666;font-size:.8em}.rank-badge[_ngcontent-%COMP%]{display:inline-block;padding:4px 8px;border-radius:12px;color:#fff;font-weight:700;min-width:30px;text-align:center}.high-score[_ngcontent-%COMP%]{color:#4caf50;font-weight:700}.medium-score[_ngcontent-%COMP%]{color:#ff9800;font-weight:700}.low-score[_ngcontent-%COMP%]{color:#f44336;font-weight:700}.stats-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:20px;margin-bottom:30px}.stat-item[_ngcontent-%COMP%]{text-align:center;padding:20px;background:#f5f5f5;border-radius:8px}.stat-item[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:2em;color:#3f51b5}.stat-item[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:5px 0 0;color:#666}.distribution-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:15px}.dist-item[_ngcontent-%COMP%]{text-align:center;padding:15px;border-radius:8px;color:#fff}.dist-item[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1.5em}.dist-item[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:5px 0 0;font-size:.9em}.dist-item.excellent[_ngcontent-%COMP%]{background:#4caf50}.dist-item.good[_ngcontent-%COMP%]{background:#ff9800}.dist-item.average[_ngcontent-%COMP%]{background:#2196f3}.dist-item.poor[_ngcontent-%COMP%]{background:#f44336}.high-percentage[_ngcontent-%COMP%]{color:#4caf50;font-weight:700}.medium-percentage[_ngcontent-%COMP%]{color:#ff9800;font-weight:700}.low-percentage[_ngcontent-%COMP%]{color:#f44336;font-weight:700}.analytics-card[_ngcontent-%COMP%], .distribution-card[_ngcontent-%COMP%], .questions-card[_ngcontent-%COMP%]{margin-bottom:20px}@media (max-width: 768px){.selection-header[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.test-select[_ngcontent-%COMP%]{min-width:auto}.stats-grid[_ngcontent-%COMP%], .distribution-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}.rankings-table[_ngcontent-%COMP%], .questions-table[_ngcontent-%COMP%]{font-size:.8em}}.questions-card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;width:100%;padding:16px;position:relative}.questions-card-header[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%]{margin:0;flex:1}.language-toggle[_ngcontent-%COMP%]{display:flex;gap:12px;margin-left:auto;background:#0000000a;padding:8px 12px;border-radius:8px;border:1px solid rgba(0,0,0,.12)}.question-content[_ngcontent-%COMP%]{padding:8px 0}.question-text[_ngcontent-%COMP%]{font-weight:500;margin:8px 0;line-height:1.4;color:#333}.description[_ngcontent-%COMP%]{margin-top:8px;padding:8px 12px;background-color:#f8f9fa;border-radius:6px;border-left:3px solid #2196F3}.description-text[_ngcontent-%COMP%]{margin:0;font-size:14px;line-height:1.4;color:#555;display:flex;align-items:flex-start;gap:8px}.description-icon[_ngcontent-%COMP%]{font-size:16px;width:16px;height:16px;color:#2196f3;margin-top:2px}.correct-count[_ngcontent-%COMP%]{color:#4caf50;font-weight:500}.incorrect-count[_ngcontent-%COMP%]{color:#f44336;font-weight:500}.high-percentage[_ngcontent-%COMP%]{color:#4caf50;font-weight:500}.medium-percentage[_ngcontent-%COMP%]{color:#ff9800;font-weight:500}.low-percentage[_ngcontent-%COMP%]{color:#f44336;font-weight:500}@media (max-width: 768px){.questions-card-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:16px}.language-toggle[_ngcontent-%COMP%]{margin-left:0;align-self:flex-end}.questions-table[_ngcontent-%COMP%]{font-size:14px}}@media (max-width: 480px){.questions-card-header[_ngcontent-%COMP%]{align-items:stretch}.language-toggle[_ngcontent-%COMP%]{align-self:stretch;justify-content:center}}"]})};export{kt as AdminResultsComponent};
